{% extends 'base.html' %}
{% load static %}
{% block page %}home{% endblock %}

{% block content %}


<!-- ================= HERO ================= -->
<section class="hero-home text-white">
  <div class="hero-overlay"></div>

  <div class="container hero-content">
    <h1 class="display-4 fw-bold">
      Discover Morocco, Beyond the Ordinary
    </h1>

    <p class="lead mb-4">
      Authentic Moroccan journeys, expertly planned
    </p>

    <form method="get" class="row g-3 hero-search">
      <div class="col-md-5">
        <input name="q" class="form-control form-control-lg"
               placeholder="Destination (Marrakech, Sahara, Atlas...)">
      </div>

      <div class="col-md-3">
        <input type="date" name="date" class="form-control form-control-lg">
      </div>

      <div class="col-md-2">
        <button class="btn btn-primary btn-lg w-100">Search</button>
      </div>
    </form>
  </div>
</section>

<!-- ================= AVAILABLE TOURS ================= -->
<section id="available-tours" class="container my-5 available-tours-section">

  <!-- Title -->
  <div class="section-header text-center mb-5">
    <h2 class="fw-bold section-title">Available Tours</h2>
    <div class="section-divider"></div>
  </div>

  <!-- Cards grid -->
  <div class="row g-4">

    {% for tour in tours %}
    <div class="col-12 col-md-6 col-lg-4 d-flex">

      <div class="card tour-card shadow-sm border-0 w-100">

        <!-- IMAGE + BADGES -->
        <div class="position-relative">

       {% if tour.image %}
  <img src="{{ tour.image.url }}" class="card-img-top" alt="{{ tour.title }}">
{% else %}
  <img src="{% static 'img/placeholder.jpg' %}" class="card-img-top">
{% endif %}


          {% if tour.is_promotion and tour.discount_percent > 0 %}
            <span class="tour-badge promo">
              -{{ tour.discount_percent }}% PROMO
            </span>
          {% endif %}

          {% if user.is_authenticated and tour.user_reservation %}
            {% if tour.user_reservation.status == 'pending' %}
              <span class="tour-badge pending">Pending</span>

            {% elif tour.user_reservation.status == 'booked' %}
              <div class="booked-overlay">
                <img src="{% static 'img/booked.png' %}" alt="Booked">
              </div>

            {% elif tour.user_reservation.status == 'rejected' %}
              <span class="tour-badge rejected">Rejected</span>
            {% endif %}
          {% endif %}

        </div>

        <!-- CONTENT -->
        <div class="card-body d-flex flex-column justify-content-between">

          <div>
            <h5 class="fw-bold">{{ tour.title }}</h5>

            <p class="text-muted mb-2">
              <i class="fa-solid fa-location-dot text-success"></i>
              {{ tour.destination.name }}
            </p>
          </div>

          <!-- PRICE + BUTTON -->
          <div class="d-flex justify-content-between align-items-center mt-3">

            <div class="price-inline">
              {% if tour.promo_price %}
                <span class="old-price">
                  {{ tour.price_per_night }} $
                </span>
                <span class="new-price">
                  {{ tour.promo_price }} $
                  <span class="discount-label">DISCOUNT</span>
                </span>
              {% else %}
                <span class="new-price">
                  {{ tour.price_per_night }} $
                </span>
              {% endif %}
            </div>

            <a href="{% url 'tour_detail' tour.id %}"
               class="btn btn-primary btn-sm">
              {% if tour.user_reservation %}See{% else %}Book{% endif %}
            </a>

          </div>

        </div>
      </div>
    </div>
    {% endfor %}

  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const params = new URLSearchParams(window.location.search);

  // Si une recherche est faite
  if (params.has("q") || params.has("date")) {

    const target = document.getElementById("available-tours");

    if (target) {
      target.scrollIntoView({
        behavior: "smooth",
        block: "center"
      });
    }
  }

});
</script>

{% endblock %}
